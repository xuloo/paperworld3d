<project name="paperworld-utils" default="new" basedir=".">

	<property file="user.properties"/>
	
	<property name="games.deploy.dir" value="../../deploy/games"/>
	<property name="games.src.dir" value="../client/games"/>
	<property name="templates.dir" value="templates"/>
	
	<property name="games.classpath" value="com.paperworld.games"/>
	<property name="games.filepath" value="com/paperworld/games"/>
	
	<property name="game.node" value="game"/>
	<property name="module.node" value="module"/>
	<property name="us.english" value="en_US"/>
	
	<taskdef name="xmltask" classname="com.oopsconsultancy.xmltask.ant.XmlTask" classpath="xmltask/xmltask-v1.15.1.jar"/>
	<taskdef classpath="ant-contrib/ant-contrib-1.0b3.jar" resource="net/sf/antcontrib/antlib.xml"/>
	
	<target name="new" description="Creates a new PaperWorld3D project">
		<echo>Creating a new project called ${name}</echo>
		
		<!-- Creates the base directory for the new project -->
		<mkdir dir="${games.deploy.dir}/${name}/lib"/>
		<mkdir dir="${games.deploy.dir}/${name}/locale/en_us"/>
		
		<!-- Copy the template conf.xml file over to the new project directory and replace the necessary tokens -->
		<copy todir="${games.deploy.dir}/${name}">
			<fileset dir="${templates.dir}">
				<include name="conf.xml"/>
			</fileset>
			<filterset>
				<filter token="NAME" value="${name}"/>
				<filter token="CLASSNAME" value="com.paperworld.games.${name}"/>
			</filterset>
        </copy>
		
		<!-- Adds a new Game node to the global config file with the new project's name -->
		<xmltask source="../../deploy/conf/config.xml" 
				dest="../../deploy/conf/config.xml"
				outputter="simple:3"
		>
			<insert path="data" xml="&lt;${game.node}&gt;&lt;/${game.node}&gt;"/>
			<attr path="data/${game.node}[last()]" attr="name" value="${name}" />
		</xmltask>
		
		<!-- Set this new project as the default game -->
		<xmltask source="../../deploy/conf/config.xml" 
				dest="../../deploy/conf/config.xml"
				outputter="simple:3"
		>
			<replace path="data/${module.node}[@name='PaperWorld']/default-module/text()" withText="${name}"/>
		</xmltask>
		
		<mkdir dir="${games.src.dir}/${name}/src/com/paperworld/games/${name}"/>
		
		<copy todir="${games.src.dir}/${name}/src/${games.filepath}/${name}">
			<fileset dir="${templates.dir}">
				<include name="NewProjectStub.as"/>
			</fileset>
			<filterset>
				<filter token="CLASS" value="${name}"/>
			</filterset>
        </copy>
		
		<move file="${games.src.dir}/${name}/src/${games.filepath}/${name}/NewProjectStub.as" toFile="${games.src.dir}/${name}/src/${games.filepath}/${name}/${name}.as"/>
		
		<mkdir dir="${games.src.dir}/${name}/assets/locale/en_us"/>
		
	</target>
	
</project>